<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta property="og:title" content="木こりチキンレース v8">
<meta property="og:description" content="1〜3回だけ切れる“チキンレース”。木を倒したら負け！交代制＆CPU対戦対応。">
<meta property="og:image" content="./ogp.png">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">

<title>木こりチキンレース v8</title>

<!-- GA4: 測定IDに置換（例: G-XXXXXXX） -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config','G-XXXX');
</script>

<style>
:root { --bg:#0b1220; --fg:#e6f0ff; --muted:#99a3be; --accent:#38bdf8; --accent-press:#fbbf24; --accent-press2:#f97316; --disabled:#374151; }
html,body { height:100%; margin:0; display:flex; align-items:center; justify-content:center; background:var(--bg); color:var(--fg);
  font-family:"Hiragino Kaku Gothic ProN","Meiryo",sans-serif; transition:background .5s,color .5s; }
body.day{ --bg:linear-gradient(#87ceeb,#b3e5fc); --fg:#0a0a0a; }
.container{ display:flex; flex-direction:column; align-items:center; gap:10px; width:100%; max-width:560px; text-align:center; padding:10px; }
header{ width:100%; display:flex; justify-content:space-between; align-items:center; font-weight:700; gap:8px; flex-wrap:wrap }
header button{ background:none; border:1px solid var(--muted); border-radius:8px; padding:6px 10px; color:var(--fg); cursor:pointer; }
.stage{ width:100%; aspect-ratio:9/16; background:linear-gradient(#0a1224,#0b1730 60%,#0b1730); border-radius:16px; border:1px solid #172038;
  position:relative; overflow:hidden; display:flex; align-items:center; justify-content:center; transition:background .5s; }
body.day .stage{ background:linear-gradient(#b3e5fc,#81d4fa 70%,#4fc3f7); }
svg.tree{ width:60%; max-width:300px; transition:transform .5s ease; transform-origin:50% 100%; position:relative; z-index:2; }
.ground{ position:absolute; bottom:15%; left:0; right:0; height:3px; background:#1e2a4a; }
button{ cursor:pointer; border:none; font-weight:700; border-radius:12px; transition:background .3s,transform .1s; }
.cutbtn{ padding:14px 22px; background:var(--accent); color:#001018; font-size:18px; }
.cutbtn:disabled{ background:var(--disabled); color:#94a3b8; }
.switchbtn{ padding:10px 20px; background:#f97316; color:#fff; font-size:16px; }
.switchbtn:disabled{ background:#555; color:#aaa; }
.cutbtn:active{ animation:press .5s; }
@keyframes press{ 0%{background:var(--accent-press);} 50%{background:var(--accent-press2);} 100%{background:var(--accent);} }
.counter{ font-size:14px; color:var(--muted); }
.msg{ font-weight:800; min-height:1.4em; }
.turnmsg{ font-weight:bold; margin-top:4px; }
#ad-top,#ad-bottom{ width:100%; min-height:60px; border:1px dashed #25324a; border-radius:10px; color:#7c8aa8; display:flex; align-items:center; justify-content:center; font-size:12px; margin:4px 0; }
.axe{ position:absolute; left:32%; bottom:30%; width:64px; height:64px; transform-origin:bottom right; z-index:3; animation:axeSwing .4s ease-in-out; }
@keyframes axeSwing{ 0%{transform:rotate(-40deg);} 50%{transform:rotate(22deg);} 100%{transform:rotate(-40deg);opacity:0;} }
.leaf{ position:absolute; width:10px; height:10px; border-radius:50%; opacity:.9; z-index:1; animation:fall var(--dur) forwards ease-in; }
@keyframes fall{ 0%{transform:translate(0,0) rotate(0deg);opacity:1;} 100%{transform:translate(var(--tx),var(--ty)) rotate(360deg);opacity:0;} }
#ruleModal{ position:fixed; inset:0; background:rgba(0,0,0,.8); display:flex; align-items:center; justify-content:center; z-index:10; }
.ruleBox{ background:#fff; color:#111; padding:20px 30px; border-radius:12px; max-width:360px; text-align:center; }
.ruleBox button{ margin-top:12px; padding:10px 20px; background:#38bdf8; color:#001018; border-radius:8px; }
footer{ font-size:12px; opacity:.7; margin:16px 0; }
.controls{ display:flex; gap:8px; justify-content:center; flex-wrap:wrap }
</style>

<!-- AdSense（自動広告）: client をあなたのIDに変更 -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXX" crossorigin="anonymous"></script>
</head>
<body>
<div class="container">
<header>
  <span>🌲 木こりチキンレース v8</span>
  <div class="controls">
    <button id="toggleTheme">🌙 夜</button>
    <button id="toggleCPU">CPU対戦: OFF</button>
  </div>
</header>

<div id="ad-top">
  <ins class="adsbygoogle" style="display:block" data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
</div>

<div class="stage" id="stage">
  <div class="ground"></div>
  <svg class="tree" id="tree" viewBox="0 0 300 400">
    <ellipse cx="150" cy="150" rx="120" ry="90" fill="#4CAF50"/>
    <ellipse cx="210" cy="170" rx="90" ry="80" fill="#5DBE4E"/>
    <ellipse cx="90" cy="170" rx="90" ry="80" fill="#66BB46"/>
    <ellipse cx="150" cy="230" rx="110" ry="80" fill="#5CB642"/>
    <rect x="125" y="230" width="50" height="150" fill="#E2BE8B" rx="10" ry="10"/>
  </svg>
</div>

<div>
  <button class="cutbtn" id="cutBtn">切　る</button>
  <button class="switchbtn" id="switchBtn">ターン交代</button>
</div>
<div class="turnmsg" id="turnMsg">🎮 プレイヤー1のターン</div>
<div class="counter">切った回数：<span id="count">0</span></div>
<div class="msg" id="msg"></div>

<div id="ad-bottom">
  <ins class="adsbygoogle" style="display:block" data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
</div>

<footer>
  <a href="./privacy.html">プライバシーポリシー</a> ／
  <a href="mailto:yourmail@example.com">お問い合わせ</a> ／
  Version: v8.1 ／ Last update: 2025-10-17
</footer>
</div>

<div id="ruleModal">
  <div class="ruleBox">
    <h3>🌲 木こりチキンレース</h3>
    <p>1ターンで「切る」を<strong>1〜3回</strong>押せます。<br>
    木を倒してしまった人が<strong>負け</strong>！<br>
    倒れる前に「ターン交代」で次の人へ。</p>
    <p style="font-size:12px;color:#555;">※「CPU対戦」ボタンで対CPUモードに切替できます</p>
    <button id="startGame">スタート</button>
  </div>
</div>

<script>
const AudioCtx=window.AudioContext||window.webkitAudioContext;let actx;
function ensureAudio(){ if(!actx) actx=new AudioCtx(); }
function chopSound(){ if(!actx) return; const t=actx.currentTime;
  const o=actx.createOscillator(), g=actx.createGain();
  o.type='square'; o.frequency.setValueAtTime(420,t);
  g.gain.setValueAtTime(0.12, t); g.gain.exponentialRampToValueAtTime(0.001, t+0.1);
  o.connect(g).connect(actx.destination); o.start(t); o.stop(t+0.1);
}
function zazaSound(){ if(!actx) return; const t=actx.currentTime;
  const dur=0.28, buf=actx.createBuffer(1, actx.sampleRate*dur, actx.sampleRate);
  const data=buf.getChannelData(0); for(let i=0;i<data.length;i++){ const env=Math.pow(1-i/data.length,2); data[i]=(Math.random()*2-1)*env*0.38; }
  const src=actx.createBufferSource(); src.buffer=buf;
  const hp=actx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=500;
  const g=actx.createGain(); g.gain.value=0.4;
  src.connect(hp).connect(g).connect(actx.destination); src.start(t); src.stop(t+dur);
}
function comedicBGM(){ if(!actx) return; const freqs=[262,330,392,440,523,494,440,392,330]; let t=actx.currentTime+.1;
  freqs.forEach(f=>{ const o=actx.createOscillator(), g=actx.createGain(); o.type='sine'; o.frequency.value=f;
    g.gain.setValueAtTime(0.0001,t); g.gain.linearRampToValueAtTime(0.07,t+.03); g.gain.exponentialRampToValueAtTime(0.0001,t+.25);
    o.connect(g).connect(actx.destination); o.start(t); o.stop(t+.25); t+=0.22; });
}

const tree=document.getElementById('tree');
const cutBtn=document.getElementById('cutBtn');
const switchBtn=document.getElementById('switchBtn');
const countEl=document.getElementById('count');
const msgEl=document.getElementById('msg');
const turnMsg=document.getElementById('turnMsg');
const toggleTheme=document.getElementById('toggleTheme');
const toggleCPU=document.getElementById('toggleCPU');
const ruleModal=document.getElementById('ruleModal');
const startGame=document.getElementById('startGame');
const stage=document.getElementById('stage');

function showAxe(){
  const axe=document.createElementNS("http://www.w3.org/2000/svg","svg");
  axe.setAttribute("class","axe"); axe.setAttribute("viewBox","0 0 64 64");
  axe.innerHTML='<rect x="28" y="8" width="8" height="44" fill="#8B5A2B" rx="3"/><path d="M20 8 L44 8 L40 24 L28 24 Z" fill="#d9dde2"/>';
  stage.appendChild(axe); setTimeout(()=>axe.remove(),400);
}
function spawnLeaves(){
  const n=10+Math.floor(Math.random()*11);
  for(let i=0;i<n;i++){
    const leaf=document.createElement('span');
    leaf.className='leaf';
    const hue=105+Math.random()*50;
    const size=6+Math.random()*8;
    const dur=(2+Math.random()*2).toFixed(2)+'s';
    leaf.style.background='hsl('+hue+' 70% 50%)';
    leaf.style.width=leaf.style.height=size+'px';
    leaf.style.left=(40+Math.random()*20)+'%';
    leaf.style.bottom='42%';
    leaf.style.setProperty('--tx',(Math.random()*220-110)+'px');
    leaf.style.setProperty('--ty',(200+Math.random()*120)+'px');
    leaf.style.setProperty('--dur',dur);
    stage.appendChild(leaf);
    setTimeout(()=>leaf.remove(), parseFloat(dur)*1000+100);
  }
}

let cuts=0, phase=0, falling=false;
let turn=1, turnCuts=0, cpuMode=false, cpuActive=false;
let fallAt=0, leanAt=0, leanAngle=-12, fallAngle=-80;
let leanSpeed=0.35, fallSpeed=0.9;

function randInt(a,b){ return Math.floor(a+Math.random()*(b-a+1)); }
function rand(a,b){ return a+Math.random()*(b-a); }

function reroll(){
  fallAt=randInt(15,50); leanAt=Math.max(2, fallAt-randInt(2,5));
  leanAngle=-randInt(8,16); fallAngle=-randInt(60,95);
  leanSpeed=rand(0.25,0.45); fallSpeed=rand(0.6,1.2);
  cuts=0; turnCuts=0; phase=0; falling=false; cpuActive=false;
  countEl.textContent=0; msgEl.textContent='';
  tree.style.transition='transform '+leanSpeed+'s ease'; tree.style.transform='rotate(0deg)';
  cutBtn.disabled=false; switchBtn.disabled=true;
  turn=1; turnMsg.textContent='🎮 プレイヤー1のターン';
}

function updateTree(){
  if(phase===0 && cuts>=leanAt){
    phase=1; tree.style.transition='transform '+leanSpeed+'s ease'; tree.style.transform='rotate('+leanAngle+'deg)';
    msgEl.textContent='…木が傾きはじめた';
  }
  if(phase<2 && cuts>=fallAt){
    phase=2; falling=true;
    tree.style.transition='transform '+fallSpeed+'s ease-in'; tree.style.transform='rotate('+fallAngle+'deg)';
    cutBtn.disabled=true; switchBtn.disabled=true;
    zazaSound(); spawnLeaves();
    msgEl.textContent='🌲 木が倒れた！ プレイヤー'+turn+' の負け！';
    setTimeout(()=>{falling=false; comedicBGM();}, fallSpeed*1000+50);
  }
}

function cutOnce(){
  ensureAudio(); chopSound(); showAxe();
  cuts++; turnCuts++; countEl.textContent=cuts; updateTree();
  if(turnCuts>=1 && phase<2){ switchBtn.disabled=false; }
  if(turnCuts>=3){ cutBtn.disabled=true; }
}

function cut(){
  if(falling || cutBtn.disabled || cpuActive) return;
  cutOnce();
}

function switchTurn(){
  if(falling || switchBtn.disabled) return;
  turn = 3 - turn; turnCuts = 0; msgEl.textContent='';
  cutBtn.disabled=false; switchBtn.disabled=true;
  turnMsg.textContent = (cpuMode && turn===2) ? '🤖 CPUのターン' : ('🎮 プレイヤー'+turn+'のターン');
  if(cpuMode && turn===2){ cpuTakeTurn(); }
}

async function cpuTakeTurn(){
  cpuActive=true;
  const n = randInt(1,3);
  for(let i=0;i<n;i++){ if(phase===2) break; cutOnce(); await new Promise(r=>setTimeout(r, 500)); }
  cpuActive=false;
  if(phase<2){ await new Promise(r=>setTimeout(r, 400)); switchTurn(); }
}

cutBtn.addEventListener('click', cut);
switchBtn.addEventListener('click', switchTurn);
stage.addEventListener('click', ()=>{ if(phase===2 && !falling){ reroll(); ruleModal.style.display='flex'; } });
startGame.addEventListener('click', ()=>{ ruleModal.style.display='none'; });

function setTheme(day){ document.body.classList.toggle('day', day); toggleTheme.textContent = day ? '🌞 昼' : '🌙 夜'; localStorage.setItem('isDay', day ? '1' : '0'); }
toggleTheme.addEventListener('click', ()=>{ const nowDay=!document.body.classList.contains('day'); setTheme(nowDay); });
window.addEventListener('load', ()=>{ const s=localStorage.getItem('isDay'); if(s==='1') setTheme(true); reroll(); });

toggleCPU.addEventListener('click', ()=>{
  cpuMode = !cpuMode;
  toggleCPU.textContent = cpuMode ? 'CPU対戦: ON' : 'CPU対戦: OFF';
  if(cpuMode && turn===2 && phase<2 && !cpuActive){ cpuTakeTurn(); }
});
</script>

<!-- AD_UNIT_PLACEHOLDER_BOTTOM: 審査通過後にここへディスプレイ広告ユニットを挿入します -->
</body>
</html>
